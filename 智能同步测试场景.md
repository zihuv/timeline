# 智能同步测试场景

## 测试环境准备

### 前置条件
1. 配置后端服务器地址
2. 确保网络连接正常
3. 准备测试数据

### 测试数据准备
- 本地测试数据：`test-data.json`
- 云端测试数据：通过API创建

## 测试场景

### 场景1：本地无数据，云端有数据

#### 测试步骤
1. **清空本地数据**
   ```javascript
   localStorage.removeItem('diaries')
   ```

2. **在云端创建测试数据**
   - 通过API创建几条日记
   - 确保云端有数据

3. **打开智能同步**
   - 点击"智能同步"按钮
   - 观察数据状态分析

4. **验证推荐策略**
   - 应该显示"从云端下载数据"
   - 本地数据状态显示为0
   - 云端数据状态显示有数据

5. **执行同步**
   - 点击"下载云端数据"按钮
   - 观察同步进度
   - 验证同步结果

#### 预期结果
- 策略类型：`download`
- 策略标题：从云端下载数据
- 策略描述：检测到云端有数据但本地为空，建议从云端下载数据到本地
- 同步后本地数据与云端数据一致

### 场景2：本地有数据，云端无数据

#### 测试步骤
1. **准备本地数据**
   ```javascript
   // 导入测试数据到本地
   const testData = JSON.parse(localStorage.getItem('diaries') || '[]')
   ```

2. **清空云端数据**
   - 通过API删除所有云端数据
   - 确保云端为空

3. **打开智能同步**
   - 点击"智能同步"按钮
   - 观察数据状态分析

4. **验证推荐策略**
   - 应该显示"上传本地数据到云端"
   - 本地数据状态显示有数据
   - 云端数据状态显示为0

5. **执行同步**
   - 点击"上传本地数据"按钮
   - 观察同步进度
   - 验证同步结果

#### 预期结果
- 策略类型：`upload`
- 策略标题：上传本地数据到云端
- 策略描述：检测到本地有数据但云端为空，建议将本地数据上传到云端
- 同步后云端数据与本地数据一致

### 场景3：本地和云端都有数据

#### 测试步骤
1. **准备本地数据**
   - 导入测试数据到本地
   - 修改部分数据的时间戳

2. **准备云端数据**
   - 通过API创建不同的测试数据
   - 确保与本地数据有重叠

3. **打开智能同步**
   - 点击"智能同步"按钮
   - 观察数据状态分析

4. **验证推荐策略**
   - 应该显示"智能合并数据"
   - 本地和云端数据状态都显示有数据

5. **执行同步**
   - 点击"智能合并数据"按钮
   - 观察合并进度
   - 验证合并结果

#### 预期结果
- 策略类型：`merge`
- 策略标题：智能合并数据
- 策略描述：检测到本地和云端都有数据，建议进行智能合并
- 合并后数据按时间戳正确合并

## 智能合并算法测试

### 测试数据准备
```json
{
  "local": [
    {
      "date": "2024-01-01",
      "entries": [
        {
          "id": "entry1",
          "content": "本地数据1",
          "timestamp": "09:00",
          "createdAt": "2024-01-01T09:00:00Z",
          "updatedAt": "2024-01-01T10:00:00Z"
        },
        {
          "id": "entry2",
          "content": "本地数据2",
          "timestamp": "11:00",
          "createdAt": "2024-01-01T11:00:00Z",
          "updatedAt": "2024-01-01T11:00:00Z"
        }
      ]
    }
  ],
  "server": [
    {
      "date": "2024-01-01",
      "entries": [
        {
          "id": "entry1",
          "content": "云端数据1（更新）",
          "timestamp": "09:00",
          "createdAt": "2024-01-01T09:00:00Z",
          "updatedAt": "2024-01-01T12:00:00Z"
        },
        {
          "id": "entry3",
          "content": "云端数据3",
          "timestamp": "14:00",
          "createdAt": "2024-01-01T14:00:00Z",
          "updatedAt": "2024-01-01T14:00:00Z"
        }
      ]
    }
  ]
}
```

### 合并结果验证
合并后应该得到：
```json
{
  "date": "2024-01-01",
  "entries": [
    {
      "id": "entry1",
      "content": "云端数据1（更新）", // 保留云端版本（时间戳更新）
      "timestamp": "09:00",
      "createdAt": "2024-01-01T09:00:00Z",
      "updatedAt": "2024-01-01T12:00:00Z"
    },
    {
      "id": "entry2",
      "content": "本地数据2", // 保留本地独有数据
      "timestamp": "11:00",
      "createdAt": "2024-01-01T11:00:00Z",
      "updatedAt": "2024-01-01T11:00:00Z"
    },
    {
      "id": "entry3",
      "content": "云端数据3", // 保留云端独有数据
      "timestamp": "14:00",
      "createdAt": "2024-01-01T14:00:00Z",
      "updatedAt": "2024-01-01T14:00:00Z"
    }
  ]
}
```

## 手动同步测试

### 测试步骤
1. **打开智能同步**
2. **点击"手动选择同步方式"**
3. **测试不同同步方向**
   - 从云端下载到本地
   - 从本地上传到云端
   - 智能合并
4. **测试不同合并策略**
   - 按时间戳合并
   - 优先保留本地数据
   - 优先保留云端数据

### 验证要点
- 手动选项正确显示
- 不同策略正确执行
- 结果符合预期

## 错误处理测试

### 网络中断测试
1. 开始同步操作
2. 断开网络连接
3. 观察错误处理
4. 恢复网络连接
5. 验证重试机制

### 服务器错误测试
1. 停止后端服务
2. 尝试同步操作
3. 观察错误提示
4. 重启后端服务
5. 验证恢复机制

## 性能测试

### 大量数据测试
1. 准备大量测试数据（1000+条日记）
2. 执行智能同步
3. 观察性能表现
4. 验证数据完整性

### 内存使用测试
1. 监控浏览器内存使用
2. 执行同步操作
3. 观察内存变化
4. 验证内存释放

## 用户体验测试

### 界面响应测试
1. 测试按钮点击响应
2. 测试进度条显示
3. 测试状态更新
4. 测试错误提示

### 操作流程测试
1. 测试完整操作流程
2. 测试中断恢复
3. 测试取消操作
4. 测试重复操作

## 测试报告模板

### 测试环境
- 浏览器版本：
- 操作系统：
- 网络环境：
- 数据量：

### 测试结果
- 场景1：✅/❌
- 场景2：✅/❌
- 场景3：✅/❌
- 手动同步：✅/❌
- 错误处理：✅/❌
- 性能表现：✅/❌

### 问题记录
- 问题描述：
- 复现步骤：
- 预期结果：
- 实际结果：

### 改进建议
- 功能改进：
- 性能优化：
- 用户体验： 